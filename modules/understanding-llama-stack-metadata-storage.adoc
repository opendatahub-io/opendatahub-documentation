:_module-type: CONCEPT

[id="understanding-llama-stack-metadata-storage_{context}"]
= Understanding Llama Stack metadata storage

[role="_abstract"]
In {productname-short}, Llama Stack requires PostgreSQL as a metadata storage backend to persist state and configuration data across multiple components. Metadata storage provides durable persistence for vector stores, file management, agent state, conversation history, and other Llama Stack services.

PostgreSQL is required as a metadata storage backend for all {productname-short} deployments. You can also use PostgreSQL with the pgvector extension as a remote vector database provider for storing and searching vector embeddings.

== Role of metadata storage in Llama Stack

Llama Stack components require persistent storage beyond in-memory data structures. Without metadata storage, component state would be lost on pod restarts or application failures.

Llama Stack uses metadata storage to persist:

* Vector store metadata, such as collection identifiers and document mappings.
* File metadata, including file locations, identifiers, and attributes.
* Agent state and conversation history.
* Dataset configurations and batch processing state.
* Model registry information and prompt templates.

This persistent storage allows Llama Stack to maintain operational state across pod restarts, rescheduling, and application updates.

== PostgreSQL metadata storage backends

Llama Stack uses PostgreSQL through two storage backend types:

* `kv_default`: A key-value store backend used for metadata that requires flexible schema storage. Components such as vector stores, dataset handlers, and the model registry use this backend.
* `sql_default`: A relational table backend used for structured data storage. Components such as the files provider, agent responses, and conversation history use this backend.

Both backend types use the same PostgreSQL instance but serve different data structure requirements within Llama Stack.

[IMPORTANT]
====
Starting with {productname-short} 3.2, PostgreSQL version 14 or later is required for all Llama Stack deployments, including development, testing, and production environments.

If validation errors occur, confirm that the deployed Llama Stack image version matches the configuration schema referenced by your `run.yaml`.
====