:_module-type: PROCEDURE
[id="configuring-the-pgvector-remote-provider-in-llama-stack_{context}"]
= Configuring the pgvector remote provider in Llama Stack

[role="_abstract"]
To use PostgreSQL with the pgvector extension as a remote vector store, configure a pgvector provider in the Llama Stack runtime configuration and supply PostgreSQL connection details to your `LlamaStackDistribution`. This configuration enables retrieval augmented generation (RAG) workflows in {productname-short} by using PostgreSQL based vector storage.

.Prerequisites
* You have installed and enabled the Llama Stack Operator in {productname-short}.
* You have a PostgreSQL database with the pgvector extension enabled.
* You have the PostgreSQL connection details, including the host name, port number, database name, user name, and password.
* You have permissions to create Secrets, ConfigMaps, and custom resources in your project.

.Procedure
. In the OpenShift web console, switch to the *Administrator* perspective.

. Create a Secret that stores the PostgreSQL connection details.
+
.. Ensure that the correct project is selected.
.. Click *Workloads* → *Secrets*.
.. Click *Create* → *From YAML*.
.. Paste the following YAML, update the placeholder values, and then click *Create*.
+
.Example Secret for pgvector connection details
[source,yaml,subs="attributes+quotes"]
----
apiVersion: v1
kind: Secret
metadata:
  name: pgvector-connection
type: Opaque
stringData:
  PGVECTOR_HOST: "pgvector"
  PGVECTOR_PORT: "5432"
  PGVECTOR_DB: "vectordb"
  PGVECTOR_USER: "postgres"
  PGVECTOR_PASSWORD: "yourpassword"
----

. Create a ConfigMap that contains the Llama Stack run configuration (`run.yaml`) with the pgvector provider enabled.
+
[IMPORTANT]
====
The pgvector provider is not enabled automatically. You must define the provider in `run.yaml` and supply the required connection values through environment variables in your `LlamaStackDistribution`.

In this example, the pgvector provider is enabled when `PGVECTOR_DB` is set.
====
+
.. Click *Workloads* → *ConfigMaps*.
.. Click *Create ConfigMap*.
.. In the *Create ConfigMap* dialog, select the *YAML view* radio button.
.. Paste the following YAML, and then click *Create*.
+
.Example ConfigMap containing run configuration with pgvector provider
[source,yaml,subs="attributes+quotes"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: llama-stack-config
data:
  run.yaml: |
    providers:
      vector_io:
      - provider_id: ${env.PGVECTOR_DB:+pgvector}
        provider_type: remote::pgvector
        config:
          host: ${env.PGVECTOR_HOST}
          port: ${env.PGVECTOR_PORT}
          db: ${env.PGVECTOR_DB}
          user: ${env.PGVECTOR_USER}
          password: ${env.PGVECTOR_PASSWORD}
----

. Update your `LlamaStackDistribution` custom resource to reference the run configuration and expose the PostgreSQL connection values as environment variables.
+
.. Click *Operators* → *Installed Operators*.
.. Select the *Llama Stack Operator*.
.. Click the *LlamaStackDistribution* tab.
.. Select your `LlamaStackDistribution` resource.
.. Click *YAML*.
.. Update the resource to include the following fields, and then click *Save*.
+
.Example `LlamaStackDistribution` configuration for pgvector
[source,yaml,subs="attributes+quotes"]
----
apiVersion: llamastack.io/v1alpha1
kind: LlamaStackDistribution
metadata:
  name: llamastack
spec:
  server:
    containerSpec:
      env:
      - name: PGVECTOR_HOST
        valueFrom:
          secretKeyRef:
            name: pgvector-connection
            key: PGVECTOR_HOST
            optional: true
      - name: PGVECTOR_PORT
        valueFrom:
          secretKeyRef:
            name: pgvector-connection
            key: PGVECTOR_PORT
            optional: true
      - name: PGVECTOR_DB
        valueFrom:
          secretKeyRef:
            name: pgvector-connection
            key: PGVECTOR_DB
            optional: true
      - name: PGVECTOR_USER
        valueFrom:
          secretKeyRef:
            name: pgvector-connection
            key: PGVECTOR_USER
            optional: true
      - name: PGVECTOR_PASSWORD
        valueFrom:
          secretKeyRef:
            name: pgvector-connection
            key: PGVECTOR_PASSWORD
            optional: true
    userConfig:
      configMapName: llama-stack-config
----

.Verification
. Click *Workloads* → *Pods*.
. Confirm that the Llama Stack pod restarts and reaches the *Running* state.
. Open the pod logs and confirm that the server starts successfully and initializes the pgvector provider without errors.
